---
templateKey: blog-post
title: ðŸš• 5 ìš°ë²„ í´ë¡  ì½”ë”© (nomad coders)
date: 2019-04-12T08:56:56.243Z
description: ìš°ë²„ ì½”ë”© ê°•ì˜ ë¡œê·¸ 1.22 ~ 1.25
featuredpost: true
featuredimage: /img/nuber_clone.jpg
tags:
  - nomad coders
  - ìš°ë²„ í´ë¡  ì½”ë”©
---
# 

## #1.22 Chat and Message Entities part One

ì €ë²ˆì— ì´ì–´ì„œ ê³„ì†í•´ì„œ íƒ€ìž…ì„ ì •ì˜í• í…ë°, ì´ë²ˆì—ëŠ” ë©”ì‹œì§€ë¥¼ ì£¼ê³  ë°›ì„ ë•Œì— ëŒ€í•œ íƒ€ìž…ì„ ì •ì˜í•  ì°¨ë¡€ë‹¤. ì§€ê¸ˆê¹Œì§€ëŠ” ë°ì´í„°ì— ê´€ê³„ì— ëŒ€í•´ì„œëŠ” ì‹ ê²½ì„ ì“°ì§€ ì•Šì•˜ë‹¤. ëª¨ë“  ë°ì´í„°ëŠ” ê´€ê³„ë¥¼ ê°€ì§€ê¸° ë•Œë¬¸ì— íŠ¹ížˆ, ê´€ê³„í˜• ë°ì´í„° ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ì´ ê´€ê³„ë¥¼ ìž˜ ë‹¤ë£¨ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.

 ìš´ì „ìžì™€ íƒ‘ìŠ¹ìž ì‚¬ì´ì—ëŠ” ë©”ì‹œì§€ë¥¼ ì£¼ê³  ë°›ì•„ì•¼ í•œë‹¤. ì˜ˆë¥¼ë“¤ë©´ ìš´ì „ìž í•œëª…ê³¼ íƒ‘ìŠ¹ìž ë‹¤ìˆ˜ê°€ ë©”ì‹œì§€ë¥¼ ì£¼ê³  ë°›ëŠ” ìƒí™©ì´ë¼ë©´ ì±„íŒ… ë°©ì€ í•˜ë‚˜ì— ì—¬ëŸ¬ ìœ ì €ê°€ ì ‘ì†í•˜ê³ , ì±„íŒ…ë°©ì—ëŠ” ë‹¤ìˆ˜ì˜ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìžˆë‹¤. ì´ë•Œ ì±„íŒ…ë°© í•˜ë‚˜ì— ë‹¤ìˆ˜ì˜ ë©”ì‹œì§€ ë˜ëŠ” ì‚¬ìš©ìžê°€ ê´€ê³„ê°€ ìƒ

ê¸°ëŠ”ë°, ì´ë¥¼ one-to-many ê´€ê³„ë¡œ ì„¤ëª…í•œë‹¤. 

![](-841e9ee6-c104-4479-a90f-5a1d40b816ed.png)

ìœ„ ê·¸ë¦¼ì€ ìš°ë¦¬ê°€ ë‚˜íƒ€ë‚¼ ê´€ê³„ë¥¼ ê´€ê³„ë„ë¡œ ë„ì‹í™” í•œ ê²ƒì´ë‹¤.

ì±„íŒ…ë°© A

ì‚¬ìš©ìž a, b, c

ë©”ì‹œì§€ 1, 2, 3

ìœ„ì²˜ëŸ¼ ìžˆì„ ë•Œ, ì±„íŒ…ë°©ì€ ì—¬ëŸ¬ ì‚¬ìš©ìžê°€ ë“¤ì–´ê°ˆ ìˆ˜ ìžˆê³ , ë˜ ì—¬ëŸ¬ ë©”ì‹œì§€ë¥¼ ê°€ì§ˆ ìˆ˜ ìžˆë‹¤. ê·¸ë¦¬ê³  ì‚¬ìš©ìžëŠ” ë©”ì‹œì§€ë¥¼ ì±„íŒ…ë°©ì— ë³´ë‚¼ ìˆ˜ ìžˆë‹¤. 

ì‚¬ìš©ìž aì™€ ë©”ì‹œì§€ 1 ê·¸ë¦¬ê³  ì±„íŒ…ë°© Aì˜ ê´€ê³„ëŠ” ì‚¬ìš©ìž aê°€ ë©”ì‹œì§€ 1ì„ ì±„íŒ…ë°© Aì— ë³´ë‚¸ ê²ƒì´ë¼ ë§í•  ìˆ˜ ìžˆë‹¤.

ì´ëŸ¬í•œ ê´€ê³„ë¥¼ ì–´ë–»ê²Œ ì½”ë“œë¡œ ë‚˜íƒ€ë‚´ëŠ”ì§€ ì‚´íŽ´ë³´ë©´ì„œ ì§„í–‰í•´ë³´ìž.

- src/api/Chat/shared/Chat.graphql íŒŒì¼ì„ ìƒì„±í•´ì„œ ë‚´ìš©ì„ ì±„ìš°ìž.

        type Chat {
          id: Int!
          messages: [Message]! #graphqlì—ì„œ ë¦¬ìŠ¤íŠ¸ í‘œí˜„
          participants: [User]! #graphqlì—ì„œ ë¦¬ìŠ¤íŠ¸ í‘œí˜„
          createAt: String!
          updateAt: String
        }

    ChatëŠ” messagesì— ë‹¤ìˆ˜ì˜ ë©”ì‹œì§€ë¥¼ ê°€ì§ˆ ìˆ˜ ìžˆê³ , participantsì— ë‹¤ìˆ˜ì˜ ìœ ì €ë¥¼ ê°€ì§ˆ ìˆ˜ ìžˆë‹¤.

- src/api/Chat/shared/Message.graphql íŒŒì¼ì„ ìƒì„±í•´ì„œ ë‚´ìš©ì„  ì±„ìš°ìž.

        type Message {
          id: Int!
          text: String!
          chat: Chat!
          user: User!
          createAt: String!
          updateAt: String
        }

    ë©”ì‹œì§€ëŠ” í•˜ë‚˜ì˜ ì±„íŒ…ë°©ê³¼ í•˜ë‚˜ì˜ ìœ ì €ì— ê´€ê³„ê°€ ìžˆë‹¤.

ìš°ë¦¬ëŠ” íŠ¹ë³„ížˆ ë‹¤ë¥¸ ë°©ë²•ì´ ì•„ë‹Œ ë°ì´í„° êµ¬ì¡°ë¥¼ í†µí•´ì„œë„ ê´€ê³„ë¥¼ íŒŒì•… í•  ìˆ˜ ìžˆë‹¤.

ì´ë²ˆì—ëŠ” Chatì™€ Messageì˜ entityë¥¼ ë§Œë“¤ ì°¨ë¡€ì¸ë°, `@ManyToOne`ì„ í†µí•´ ê´€ê³„ë¥¼ ëª…ì‹œí•œë‹¤.

ì¼ë‹¨ entity í‹€ì„ ë¨¼ì € ìƒì„±í•´ì„œ ì„œë¡œë¥¼ ì°¸ì¡° í•  ìˆ˜ ìžˆë„ë¡ í•˜ìž.

- src/entities/Chat.ts

        import {
          BaseEntity,
          CreateDateColumn,
        	Entity,
          PrimaryGeneratedColumn,
          UpdateDateColumn,
         } from 'typeorm'
        
        @Entity()
        class Chat extends BaseEntity {
          @PrimaryGeneratedColumn() id: number;
        
        
          @CreateDateColumn() createAt: string;
          @UpdateDateColumn() updateAt: string;
        }
        
         export default Chat;

- src/entities/Message.ts

        import {
          BaseEntity,
          CreateDateColumn,
        	Entity,
          PrimaryGeneratedColumn,
          UpdateDateColumn,
         } from 'typeorm'
        
        @Entity()
        class Message extends BaseEntity {
          @PrimaryGeneratedColumn() id: number;
          
          @CreateDateColumn() createAt: string;
          @UpdateDateColumn() updateAt: string;
        }
        
         export default Message;

ì´ë²ˆì—ëŠ” Chat ì™€ Message ì‚¬ì´ì— ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ì¤„ ê²ƒì´ë‹¤. (ì¼ì‹œì ìœ¼ë¡œ ì°¸ì¡°ì˜ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìžˆë‹¤.)

- src/entities/Chat.ts

        import {
          BaseEntity,
          CreateDateColumn,
        	Entity,
          OneToMany, //ì¶”ê°€
          PrimaryGeneratedColumn,
          UpdateDateColumn,
         } from 'typeorm'
        import Message from './Message'; //ìž„í¬íŠ¸
        
        @Entity()
        class Chat extends BaseEntity {
          @PrimaryGeneratedColumn() id: number;
        
          @OneToMany(type => Message, message => message.chat)
          messages: Message[]
        
          @CreateDateColumn() createAt: string;
          @UpdateDateColumn() updateAt: string;
        }
        
         export default Chat;

- src/entities/Message.ts

        import {
          BaseEntity,
          CreateDateColumn,
        	Entity,
        	ManyToOne, //ì¶”ê°€
          PrimaryGeneratedColumn,
          UpdateDateColumn,
         } from 'typeorm'
        import Chat from './Chat'; //ìž„í¬íŠ¸
        
        @Entity()
        class Message extends BaseEntity {
          @PrimaryGeneratedColumn() id: number;
        
          @ManyToOne(type => Chat, chat => chat.messages)
          chat: Chat;
          
          @CreateDateColumn() createAt: string;
          @UpdateDateColumn() updateAt: string;
        }
        
         export default Message;

ManyToOneê³¼ OneToManyê°€ í—·ê°ˆë¦¬ì‹¤ê¹Œë´, í‘œì‹œë¥¼ í•´ë´¤ìŠµë‹ˆë‹¤. 

Message í´ëž˜ìŠ¤ ì •ì˜ì—ì„œ "ë‹¤ìˆ˜ì˜ Message ê°€ í•˜ë‚˜ì˜ Chatê³¼ ê´€ê³„ë¥¼ ê°€ì§„ë‹¤." ë¡œ ì´í•´í•˜ì‹œë©´ ë˜ê³  "ê·¸ ë‹¤ìˆ˜ì˜ ë©”ì‹œì§€ëŠ” chat.messages" ì´ë‹¤.ë¡œ ì´í•´í•˜ì‹œë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.

![](_2019-04-11__10-bd368ede-2d6f-40d6-965d-8d0665553f26.33.58.png)

Chat í´ëž˜ìŠ¤ëŠ”  Messageì™€ ë°˜ëŒ€ë¡œ `@OneToMany`ìž…ë‹ˆë‹¤.  ìœ„ì— ì„¤ëª…ë“œë¦° ë°©ì‹ìœ¼ë¡œ ì´í•´í•´ë³´ì‹œë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.

## #1.23 Chat and Message Entities part Two

ìœ„ì—ì„œ entityì˜ ëª‡ê°€ì§€ ì†ì„±ì— ëŒ€í•´ì„œëŠ” ì¶”ê°€í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ í–ˆë˜ ë‚´ìš©ìœ¼ë¡œ ìŠ¤ìŠ¤ë¡œ í•´ë³´ì‹œë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.

- src/api/User/shared/User.graphql íŒŒì¼ì— Chatì™€ Message ê´€ë ¨ ì†ì„±ì„ ì¶”ê°€í•©ë‹ˆë‹¤. ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ë ¤ë©´ ì„œë¡œì˜ ì†ì„±ì„ ê°€ì§€ê³  ìžˆì–´ì•¼ í•œë‹¤.

        type User {
        	...
          chat: Chat
          messages: [Message]
          isDriving: Boolean!
          ...
        }
        
        type Query {
          user: User
        }

- src/entities/User.ts ì—ëŠ” Chatì™€ Messageë¥¼ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ê¸° ìœ„í•´ ì¶”ê°€í•´ì¤˜ì•¼ í•œë‹¤.

        ...
        	Entity,
          ManyToOne,
          OneToMany, 
          PrimaryGeneratedColumn,
          UpdateDateColumn,
        } from 'typeorm';
        import Chat from './Chat';
        import Message from './Message';
        
        ...
        @Column({ type: "text"})
        profilePhoto: string;
        
        @ManyToOne(type => Chat, chat => chat.participants)
        chat: Chat;
        
        @OneToMany(type => Message, message => message.user)
        messages: Message[];
        
        @Column({ type: "boolean", default: false})
        isDriving: Boolean!
        ...

- src/entities/Message.ts ì—ëŠ” text, Chat, User ê°€ ë¹ ì¡Œë‹¤.

        ...
        import User from './User';
        
        @Entity()
        class Message extends BaseEntity {
          @PrimaryGeneratedColumn() id: number;
        
          @Column({type: "text"})
          text: string
        
          @ManyToOne(type => Chat, chat => chat.messages)
          chat: Chat;
        
          @ManyToOne(type => User, user => user.messages)
          user: User;
          
          @CreateDateColumn() createAt: string;
          @UpdateDateColumn() updateAt: string;
        }
        
         export default Message;

- src/entities/Chat.ts ì—ëŠ” User ì†ì„±ì´ ë¹ ì¡Œë‹¤. ì¶”ê°€

        ...
        import User from './User';
        
        @Entity()
        class Chat extends BaseEntity {
        	...
        
          @OneToMany(type => User, user => user.chat)
          participants: User[]
        
          @CreateDateColumn() createAt: string;
          @UpdateDateColumn() updateAt: string;
        }
        
         export default Chat;

## #1.24 Model Relationships like a Boss

ì´ë²ˆì—ëŠ” Verificationê³¼ Userì˜ ê´€ê³„, Rideì™€ Userì˜ ê´€ê³„ë¥¼ ì…‹íŒ…í•œë‹¤.

- src/api/Verification/shared/Verification.graphql ì— userë¥¼ ê°„ë‹¨ížˆ ì¶”ê°€í•˜ìž.

        type Verification {
          ...
          used: Boolean!
          user: User!
          createAt: String!
          updateAt: String
        

- src/api/User/shared/User.graphql ì—ëŠ” verificationsê³¼ ridesAsPassenger, ridesAsDriver ë‘˜ë‹¤ ì¶”ê°€í•œë‹¤.

        type User {
          ..
          chat: Chat
          messages: [Message]
          verifications: [Verification]
          ridesAsPassenger: [Ride]
          ridesAsDriver: [Ride]
          isDriving: Boolean!
          ...
        }
        
        type Query {
          user: User
        }

- src/api/Ride/shared/Ride.graphql ì—ëŠ” driverì™€ passengerë¥¼ ì¶”ê°€ í•œë‹¤.

        type Ride {
          ...
          price: Float!
          driver: User!
          passenger: User!
          distance: String!
          ...
        }

1.23 ì ˆì—ì„œ í•œ ê²ƒ ì²˜ëŸ¼ graphql íƒ€ìž…ì„ í†µí•´ entityì— ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì—°ìŠµì„ í•´ë³´ëŠ” ê²ƒì„ ê¶Œí•œë‹¤.

- src/entities/Verification.ts ìž„í¬íŠ¸ ìˆœì„œë¥¼ ì‚´ì§ ì†ë´¤ë‹¤.

        import {
          BaseEntity,
          BeforeInsert,
          Column,
          CreateDateColumn,
        	Entity,
          ManyToOne,
          PrimaryGeneratedColumn,
          UpdateDateColumn,
         } from 'typeorm'
        import { verificationTarget } from 'src/types/types';
        import User from './User';
        
        	...
        
          @ManyToOne(type => User, user => user.verifications)
          user: User;
        
          @CreateDateColumn() createAt: string;
          @UpdateDateColumn() updateAt: string;
        
        	...

- src/entities/User.ts Verificationê³¼ Ride ê´€ê³„ë¥¼ ì¶”ê°€í•œë‹¤.

        ...
        import Message from './Message';
        import Verification from './Verification';
        import Ride from './Ride';
        
        	...
        
          @OneToMany(type => Message, message => message.user)
          messages: Message[];
        
          @OneToMany(type => Verification, verification => verification.user)
          verifications: Verification[];
        
          @OneToMany(type => Ride, ride => ride.passenger)
          ridesAsPassenger: Ride[];
        
          @OneToMany(type => Ride, ride => ride.driver)
          ridesAsDriver: Ride[];
        
          @Column({ type: "boolean", default: false})
          isDriving: boolean;
        
          ...

- src/entities/Ride.ts Userì™€ì˜ ê´€ê³„ë¥¼ ì¶”ê°€í•œë‹¤. UserëŠ” driverì™€ Passengerë‹¤

        import {
          ...
        	Entity,
          ManyToOne,
          PrimaryGeneratedColumn,
          ...
        
        import User from './User';
        
          ...
        
          @Column({type: "text"})
          duration: string;
        
          @ManyToOne(type => User, user => user.ridesAsPassenger)
          passenger: User;
        
          @ManyToOne(type => User, user => user.ridesAsDriver)
          driver: User;
        
          @CreateDateColumn() createAt: string;
          ...

## #1.25 Resolver Types

ì´ë²ˆì—ëŠ” ì‘ë‹µ graphqlì˜ Resolver Typesë¥¼ ë§Œë“¤ ê²ƒì´ë‹¤. graphqlì—ì„œ Resolverë¼ëŠ” ê°œë…ì„ ë‚˜ ìŠ¤ìŠ¤ë¡œë„ ëª…í™•ížˆ ì´í•´ë¥¼ ëª»í•œ ìƒíƒœì´ë‹¤. ì´ë¶€ë¶„ì€ ë”°ë¡œ ê³µë¶€í•´ì„œ ì¢€ ë” ë³´ì™„í•˜ëŠ” ê²ƒìœ¼ë¡œ í•˜ê³  

- src/types/resolvers.d.ts ì„ ìƒˆë¡œ ë§Œë“¤ì–´ì„œ ê¸°ë³¸ì ì¸ resolver íƒ€ìž…ì„ ì •ì˜í•˜ìž.

        export type Resolver = (parent: any, args: any, context: any, info: any) => any;
        
        export interface Resolvers {
          [key: string]: {
            [key: string]: Resolver;
          }
        }
        
        // const resolvers: Resolvers = {
        //   Query: {
        //     sayHello: () => ""
        //   }
        // }