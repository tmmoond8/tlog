---
templateKey: blog-post
title: ğŸš• 11 ìš°ë²„ í´ë¡  ì½”ë”© (nomad coders)
date: 2019-04-28T08:56:56.243Z
description: ìš°ë²„ ì½”ë”© ê°•ì˜ ë¡œê·¸ 1.60 ~ 1.63
featuredpost: true
featuredimage: /img/nuber_clone.jpg
tags:
  - nomad coders
  - ìš°ë²„ í´ë¡  ì½”ë”©
  - TypeORM
  - GraphQL
---
# 

> í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•  ë•Œ tslintê°€ ì •ìƒì ìœ¼ë¡œ ëŒê³  ìˆì§€ ì•Šì•˜ëŠ”ë°, ì›ì¸ì´ tslintë¥¼ ê¸€ë¡œë²Œë¡œ ì„¤ì¹˜ë¥¼ í•˜ê³  typescriptë˜í•œ ê¸€ë¡œë²Œë¡œ ì„¤ì¹˜ë¥¼ í•´ì•¼ í–ˆì—ˆë‹¤. ì´ëŸ° ë²„ê·¸ë¥¼ ìˆ˜ì •í•˜ê³  ë‚˜ë‹ˆ tslintê°€ import ìˆœì„œë¥¼ ì§€ì  ë§ì´ í•´ì¤˜ì„œ ë¶€ë“ì´í•˜ê²Œ #1.62 ë¶€í„° tslintì—ì„œ ì¡ì•„ì¤€ import ìˆœì„œëŒ€ë¡œ ì½”ë“œë¥¼ ì˜¬ë¦¬ê²Œ ëë‹¤.

ì´ë²ˆì—ëŠ” Place ì •ë³´ë¥¼ ì¶”ê°€í•˜ê³  ì‚­ì œí•˜ê³  ë³€ê²½í•˜ëŠ” ê³¼ì •ì„ ì§„í–‰í•  ì˜ˆì •ì´ë‹¤.

## #1.60 AddPlace Resolver

ì´ë²ˆì—ëŠ” ì¥ì†Œë¥¼ ì¶”ê°€í•˜ëŠ” typeê³¼ Mutationì„ ì •ì˜í•  ì°¨ë¡€ë‹¤. í•œ ì‚¬ëŒì€ ì—¬ëŸ¬ ì¥ì†Œë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë‹¤. ì£¼ì†Œê°€ ê°™ì€ ì¥ì†Œë˜ë„ ì‚¬ìš©ìë§ˆë‹¤ ë…ë¦½ì ìœ¼ë¡œ ê°€ì§€ëŠ” í˜•íƒœì¸ê±° ê°™ë‹¤. ê¸°ì¡´ì—ëŠ” ì¥ì†Œì™€ ìœ ì €ì™€ì˜ ê´€ê³„ê°€ ì—†ì—ˆê¸° ë•Œë¬¸ì— ì¶”ê°€í•œë‹¤.

- src/api/User/shared/User.graphql í•„ë“œì— placesë¥¼ ì¶”ê°€ í•˜ì.

        ...
        ridesAsDriver: [Ride]
        places: [Place]
        isDriving: Boolean!
        ...

- src/api/Place/shared/Place.graphql  í•„ë“œì— userë¥¼ ì¶”ê°€í•˜ì.

        ...
        isFav: Boolean!
        user: User!
        createAt: String!
        ...

- src/entities/Place.ts

        ...
          Entity,
        	ManyToOne,
          PrimaryGeneratedColumn,
          UpdateDateColumn,
         } from 'typeorm'
        import User from './User'
        
        ...
        
        
          @Column({ type: "boolean"})
          isFav: boolean;
        
          @ManyToOne(type => User, user => user.places)
          user: User
        
          @CreateDateColumn() createAt: string;
          @UpdateDateColumn() updateAt: string;
        }
        
         export default Place;

- src/entities/User.ts

        ...
        import Ride from './Ride';
        import Place from './Place';
        
        ...
        
          @OneToMany(type => Ride, ride => ride.driver)
          ridesAsDriver: Ride[];
        
          @OneToMany(type => Place, place => place.user)
          places: Place[];
        
          @Column({ type: "boolean", default: false})
          isDriving: boolean;
        ...

entitiesì— ê´€ê³„ë¥¼ ì¶”ê°€í–ˆë‹¤.

- src/api/Place/AddPlace/AddPlace.graphql

        type AddPlaceResponse {
          ok: Boolean!
          error: String
        }
        
        type Mutation {
          AddPlace(
            name: String!
            lat: Float!
            lng: Float!
            address: String!
            isFav: Boolean!
          ): AddPlaceResponse!
        }

- src/api/Place/AddPlace/AddPlace.resolvers.ts

        import { Resolvers } from "src/types/resolvers";
        import { AddPlaceMutationArgs, AddPlaceResponse } from "src/types/graph";
        import privateResolver from "../../../utils/privateResolver";
        import Place from "../../../entities/Place";
        import User from "../../../entities/User";
        
        const resolvers: Resolvers = {
          Mutation: {
            AddPlace: privateResolver(async (
              _, 
              args: AddPlaceMutationArgs, 
              { req }
            ) : Promise<AddPlaceResponse> => {
              const user: User = req.user;
              try {
                await Place.create({ ...args, user }).save();
                return {
                  ok: true,
                  error: null
                }
              } catch(error) {
                return {
                  ok: false,
                  error: error.message
                }
              } 
            })
          }
        };
        
        export default resolvers;

ì¥ì†Œì— ëŒ€í•œ ì •ë³´ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì€ ê°„ë‹¨í•˜ê²Œ ëë‚¬ë‹¤.

## #1.61 EditPlace Resolver

Placeì— ëŒ€í•œ ì •ë³´ë¥¼ ë³€ê²½í•  í•„ìš”ê°€ ìˆë‹¤.

- src/api/Place/EditPlace/EditPlace.graphql

        type EditPlaceResponse {
          ok: Boolean!
          error: String
        }
        
        type Mutation {
          EditPlace(
            placeId: Int!,
            name: String,
            isFav: Boolean
          ): EditPlaceResponse!
        }

- src/api/Place/EditPlace/EditPlace.resolvers.ts

        import { EditPlaceMutationArgs, EditPlaceResponse } from "src/types/graph";
        import { Resolvers } from "src/types/resolvers";
        import Place from "../../../entities/Place";
        import User from "../../../entities/User";
        import cleanNullArgs from "../../../utils/cleanNullArgs";
        import privateResolver from "../../../utils/privateResolver";
        
        const resolvers: Resolvers = {
          Mutation: {
            EditPlace: privateResolver(async (
              _, 
              args : EditPlaceMutationArgs, 
              { req }
            ) : Promise<EditPlaceResponse> => {
              const user: User = req.user;
              try {
                const place = await Place.findOne({id: args.placeId}, { relations: ["user"] });
                if(place) {
                  if(place.user.id === user.id) {
                    const notNull: any = cleanNullArgs(args);
        						delete notNull.placeId;
                    await Place.update({ id: args.placeId }, { ...notNull });
                    return {
                      ok: true,
                      error: null
                    }
                  } else {
                    return {
                      ok: false,
                      error: 'Not Authorized'
                    }
                  }
                } else {
                  return {
                    ok: false,
                    error: 'Place not found'
                  }
                }
              } catch (error) {
                return {
                  ok: true,
                  error: error.message
                }
              }
            })
          }
        }
        
        export default resolvers;

ì‘ì„±í•œ ì½”ë“œë¥¼ ì‚´í´ë³´ì. ì²˜ìŒ ë³´ëŠ” í‘œí˜„ì´ ìˆë‹¤. 

    const place = await Place.findOne({id: args.placeId}, { relations: ["user"] });

place entityëŠ” userì— ê´€ê³„ë˜ì–´ ìˆë‹¤. place ë¥¼ê°€ì ¸ì˜¬ ë•Œ, ê´€ê³„ê°€ ìˆëŠ” user ë¥¼ ê°™ì´ ê°€ì ¸ì˜¬ë¼ê³  í•˜ë©´ ìœ„ì²˜ëŸ¼ relations ì˜µì…˜ì„ ì¤˜ì•¼ì§€ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

ì´ëŸ° ë°©ì‹ì€ ì¼ë°˜ì ì¸ ê´€ê³„í˜• DBì˜ ë°©ì‹ì´ì§€ë§Œ ë‚´ê°€ í•„ìš”í•œ ë°ì´í„°ëŠ” `[user.id](http://user.id)` í•˜ë‚˜ ë¿ì¸ë° ë„ˆë¬´ í° ë¹„ìš©ì´ ë°œìƒí•œë‹¤ê³  ìƒê°í•  ìˆ˜ ìˆë‹¤. ê·¼ë° ì¡°íšŒí•  ë•Œ í•„ìš”í•˜ì§€ ì•Šì€ë° ëª¨ë‘ ê°€ì ¸ì™€ ë²„ë¦¬ë©´ DBì˜ ì„±ëŠ¥ ë¬¸ì œê°€ ë°œìƒí•  ê²ƒì´ë‹¤.ê·¸ë˜ì„œ ìš°ë¦¬ëŠ” place entityì— userId í•„ë“œë¥¼ ì¶”ê°€í•´ì„œ ì†ì‰½ê²Œ ê°€ì ¸ì˜¬ ê²ƒì´ë‹¤.

- src/api/Place/shared/Place.graphql ì— userId í•„ë“œë¥¼ ì¶”ê°€í•˜ì.

        ...
          isFav: Boolean!
          userId: Int
          user: User!
        ...

- src/entities/Place.ts

        ...
        	@Column({ type: "boolean"})
          isFav: boolean;
        
          @Column({nullable: true})
          userId: number;
        
          @ManyToOne(type => User, user => user.places)
          user: User
        ...

ì—¬ê¸°ì„œ typeormì´ í•˜ëŠ” ë©‹ì§„ì¼ì´ ìˆëŠ”ë°, Placeë¥¼ ì €ì¥í•  ë•Œ ë”°ë¡œ uesrIdì— ê°’ì„ ì±„ìš¸ í•„ìš”ì—†ì´ user ì— ê°’ì„ ë„£ìœ¼ë©´ `user.id`ê°€ userIdìœ¼ë¡œ ìë™ìœ¼ë¡œ ì±„ì›Œì§„ë‹¤ê³  í•œë‹¤. ì°¨ì´ë¼ë©´ typeì„ ì •ì˜í•˜ì§€ ì•ŠëŠ” ê±°??

ì´ì œ relationsë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì€ ì½”ë“œë¡œ ì¡°ê¸ˆ ë³€ê²½í•˜ì

- src/api/Place/EditPlace/EditPlace.resolvers.ts

        ...
              try {
                const place = await Place.findOne({id: args.placeId});
                if(place) {
                  if(place.userId === user.id) {
                    const notNull = cleanNullArgs(args);
        ...

ê°•ì˜ì—ì„œëŠ” ì–¸ê¸‰ë˜ì§€ ì•Šì§€ë§Œ ë‚´ê°€ ê²ªì€ ì˜¤ë¥˜ê°€ ìˆì—ˆë‹¤. 

    const notNull: any = cleanNullArgs(args);
    delete notNull.placeId;
    await Place.update({ id: args.placeId }, { ...notNull });

argsì—ëŠ” placeIdë¼ëŠ” í”„ë¡œí¼í‹°ê°€ ìˆë‹¤. ì´ ê°’ì— ì¼ì¹˜í•˜ëŠ” idë¥¼ ê°€ì§„ Placeë¥¼ ì°¾ëŠ”ë°, ì´ë•Œ

notNull ê°ì²´ê°€ placeIdë¥¼ í”„ë¡œí¼í‹°ë¡œ ê°–ëŠ”ê²Œ ë¬¸ì œë‹¤. id ë¥¼ ì—…ë°ì´íŠ¸ í•˜ëŠ” ê²ƒ ìì²´ë„ ë…¼ë¦¬ì ìœ¼ë¡œ ë¬¸ì œì§€ë§Œ, Place entityì—ëŠ” idëŠ” ì •ì˜ë˜ì–´ ìˆì§€ë§Œ placeIdê°€ ì •ì˜ë˜ì–´ ìˆì§€ ì•Šë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì˜¤ë¥˜ê°€ ë°œìƒí•´ì„œ placeIdëŠ” ì¼ì¹˜í•˜ëŠ” ê°’ì„ ì°¾ëŠ”ë°ì—ë§Œ ì“°ê¸° ë•Œë¬¸ì— ì œê±°í•˜ëŠ” ë¡œì§ì„ ì¶”ê°€ í•˜ì˜€ë‹¤.

## #1.62 DeletePlace Resolver

place ì‚­ì œ ê´€ë ¨ ì½”ë“œë‹¤. íŠ¹ë³„íˆ ì„¤ëª…í•  ê²ƒì€ ì—†ë‹¤.

- src/api/Place/DeletePlace/DeletePlace.graphql

        type DeletePlaceResponse {
          ok: Boolean!
          error: String
        }
        
        type Mutation {
          DeletePlace(placeId: Int!) : DeletePlaceResponse!
        }

- src/api/Place/DeletePlace/DeletePlace.resolvers.ts

        import { DeletePlaceMutationArgs, DeletePlaceResponse } from "src/types/graph";
        import { Resolvers } from "src/types/resolvers";
        import Place from "../../../entities/Place";
        import User from "../../../entities/User";
        import privateResolver from "../../../utils/privateResolver";
        
        const resolvers: Resolvers = {
          Mutation: {
            DeletePlace: privateResolver(async (
              _, 
              args: DeletePlaceMutationArgs, 
              { req }
            ): Promise<DeletePlaceResponse> => {
              const user: User = req.user;
              try {
                const place = await Place.findOne({ id: args.placeId });
                if(place) {
                  if(place.userId === user.id) {
                    place.remove();
                    return {
                      ok: true,
                      error: null
                    }
                  } else {
                    return {
                      ok: false,
                      error: 'Not Authorized'
                    }
                  }
                } else {
                  return {
                    ok: false,
                    error: 'Place not found'
                  }
                }
              } catch(error) {
                return {
                  ok: false,
                  error: error.message
                }
              }
            })
          }
        }
        
        export default resolvers;

## #1.63 GetMyPlaces Resolver and Testing

- src/api/Place/GetMyPlace/GetMyPlace.graphql

        type GetMyPlaceResponse {
          ok: Boolean!
          error: String
          places: [Place]
        }
        
        type Query {
          GetMyPlace: GetMyPlaceResponse!
        }

- src/api/Place/GetMyPlace/GetMyPlace.resolvers.ts

        import { GetMyPlaceResponse } from "src/types/graph";
        import { Resolvers } from "src/types/resolvers";
        import User from "../../../entities/User";
        import privateResolver from "../../../utils/privateResolver";
        
        const resolvers: Resolvers = {
          Query: {
            GetMyPlace: privateResolver(async (_, __, { req }) : Promise<GetMyPlaceResponse> => {
              try {
                const user: any = await User.findOne(
                  { id: req.user.id },
                  { relations: ["places"]}
                );
                if(user) {
                  return {
                    ok: true,
                    error: null,
                    places: user.places
                  }
                } else {
                  return {
                    ok: false,
                    error: "User not found",
                    places: null
                  }
                }
              } catch(error) {
                return {
                  ok: false,
                  error: error.message,
                  places: null
                }
              }
            })
          }
        }
        
        export default resolvers;

ì§€ê¸ˆê¹Œì§€ ì‘ì„±í•œ mutationê³¼ queryë¥¼ í…ŒìŠ¤íŠ¸ í•´ë³´ì.

[http://localhost:4000/playground](http://localhost:4000/playground) ì— ì ‘ê·¼í•´ì„œ ë‹¤ìŒì˜ ì¿¼ë¦¬ë¥¼ ë‚ ë ¤ë³´ì. ë¬¼ë¡  ìš”ì²­ í—¤ë”ì— tokenì„ í¬í•¨í•˜ëŠ” ê²ƒì„ ìŠì§€ ë§ì•„ì•¼ í•œë‹¤.

    query {
      GetMyPlace {
        ok
        error
        places {
          id
          name
          isFav
        }
      }
    }

ì •ìƒì ìœ¼ë¡œ ê°€ì ¸ì˜¤ì§€ë§Œ placesê°€ ë¹ˆ ë°°ì—´ì¼ ê²ƒì´ë‹¤. ì•„ë˜ì— ì¥ì†Œ í•˜ë‚˜ë¥¼ ì¶”ê°€í•´ë³´ì.

    mutation {
      AddPlace(name: "home", lat: 133.1, lng: 32.3, address: "ëŒ€í•œë¯¼êµ­ ì„œìš¸", isFav: true) {
        ok
        error
      }
    }

ì´ í›„ ë‹¤ì‹œ `GetMyPlace`ì¿¼ë¦¬ë¥¼ ë³´ë‚´ë©´ ì¥ì†Œê°’ì´ ë“¤ì–´ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì„ì˜ë¡œ í•˜ë‚˜ ë” ì¶”ê°€ í•´ë³´ì.

    mutation {
      AddPlace(name: "work", lat: 9.1, lng: 1.3, address: "ëŒ€í•œë¯¼êµ­ íŒêµ", isFav: false) {
        ok
        error
      }
    }

ì´ì œ EditPlaceë¥¼ í˜¸ì¶œí•˜ì. ì œì¼ ë¨¼ì € ì¶”ê°€í•œ placeê°€ ë³€ê²½ë  ê²ƒì´ë‹¤. GetMyPlaceë¡œ ë³€ê²½ëœ ê²ƒì„ í™•ì¸í•˜ì.

    mutation {
      EditPlace(placeId: 1, name: "ì¦ê±°ìš´ ë‚˜ì˜ì§‘") {
        ok
        error
      }
    }

DeletePlaceë¡œ í˜¸ì¶œí•˜ì.

    mutation {
      DeletePlace(placeId: 2) {
        ok
        error
      }
    }

ì •ìƒì ìœ¼ë¡œ ì‘ë™ í•œë‹¤.!